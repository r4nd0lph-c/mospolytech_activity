{% extends "main/base.html" %}
{% load i18n %}
{% load static %}

{% block body %}
    {{ rating_display_form.media }}
    <!-- main START -->
    <main class="container-fluid">
        <div class="row flex-nowrap">
            <!-- sidebar menu START -->
            <div class="col-auto g-0">
                {# TODO: fix laggy collapse #}
                <div id="sidebar" class="collapse collapse-horizontal show vh-100 border-end">
                    <div class="custom-container px-4">
                        <header class="text-center my-3" style="max-width: 310px;">
                            <div class="inner" style="padding: 0;">
                                <img src="{% static logo_link %}" alt="{% trans 'LOGO [Mospolytech Activity]' %}"/>
                            </div>
                        </header>
                        <div class="content">
                            <form style="align-self: center;" id="rating-form"> 
                                {% csrf_token %}
                                <div class="container">
                                    <h5 class="fw-light mb-2 text-truncate">{% trans "Display" %}</h5>
                                    <p> {{ rating_display_form.display_choices }} </p>
                                    <p> {{ rating_display_form.display_type }} </p>
                                    <p> {{ rating_display_form.date_day }} </p>
                                    <p> {{ rating_display_form.date_week }} </p>
                                    <p> {{ rating_display_form.date_month }} </p>
                                    <p> {{ rating_display_form.date_year }} </p>
                                </div>
                                <div id="form-buttons" class="row mt-4">
                                    <div class="col-sm-6 mb-3">
                                        <button type="button" id="btn-search" class="btn btn-primary">
                                            {% trans "Search" %}
                                        </button>
                                    </div>
                                    <div class="col-sm-6 mb-3">
                                        <button type="button" class="btn btn-light disabled"
                                                style="border-color: #babbbc;">
                                            {% trans "Export" %}
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <footer class="text-center">
                            <a href="#" class="text-decoration-none text-truncate"
                               data-bs-toggle="modal" data-bs-target="#about_modal">
                                {% trans "About Service" %}
                            </a>
                        </footer>
                    </div>
                </div>
            </div>
            <!-- sidebar menu END -->

            <!-- modal START -->
            <div class="modal fade" id="about_modal" tabindex="-1"
                 aria-labelledby="about_modal_label" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="about_modal_label">{% trans "About Service" %}</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body text-start">
                            <h6>{% trans "In order to use the service" %}:</h6>
                            <br>
                            <p>
                                <b>1.</b>
                                {% trans "Enter the student's case-sensitive full name in the first field. The search will be performed across all groups. If you want to search for a specific group/groups, enter the number of the group you are interested in in the second field. After specifying it, a list of students of this group will be displayed. Next, select the required student from the updated list." %}
                            </p>
                            <p>
                                <b>2.</b>
                                {% trans "Below, in the third field, select the date display format: 'Day', 'Week', 'Month'. Then select the desired date." %}
                            </p>
                            <p>
                                <b>3.</b>
                                {% trans "After clicking the 'Search' button, the entire attendance of the student you are interested in during the specified period will be displayed." %}
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <!-- modal END -->

            <!-- primary screen START -->
            <div class="col g-0 custom-container" style="height: 100vh;">
                <!-- navbar menu START -->
                <nav class="container-fluid border-bottom">
                    <div class="row align-items-center" style="min-height: 96px;">
                        <div class="col-auto">
                            <a href="#" class="text-decoration-none" data-bs-target="#sidebar"
                               data-bs-toggle="collapse">
                                <i id="sidebar-icon" class="bi bi-x-lg bi-lg py-2 p-1"></i>
                                <span>{% trans "Menu" %}</span>
                            </a>
                        </div>
                        <div id="nav-selected-student" class="col-lg">
                            <h5 class="fw-light m-0">{% trans "Выберите рейтинг, для просмотра информации" %}</h5>
                        </div>
                        <div class="col-auto">
                            <span class="me-2">{% trans "You are logged in as" %} <b>{{ username }}</b></span>
                            {% if user.is_superuser %}
                                <a href="{% url 'admin:index' %}" class="text-decoration-none">
                                    {% trans "View admin panel" %}
                                </a><span> / </span>
                                
                            
                                <a href="{% url 'index' %}">Посещения</a>
                                <span> / </span>
                                {% endif %}
                            <a href="{% url 'logout' %}" class="text-decoration-none">
                                {% trans "Log Out" %}
                               
                                
                            </a>
                        </div>
                    </div>
                </nav>
                <!-- navbar menu END -->

                <!-- content START -->
                <div id="main-content" class="p-4 content">
                    <!-- empty filler START -->
                    <div id="empty_filler" class="inner" style = "display:none;">
                        <header>
                            <div class="inner">
                                <img src="{% static 'main/graphics/empty_filler.svg' %}"
                                     alt="{% trans 'Empty Filler (svg)' %}"
                                     style="opacity: 0.5; display: block; margin: auto;"/>
                            </div>
                        </header>
                        <div>
                            <p style="text-align: center;">{% trans "Выберите критерии рейтинга" %}</p>
                            <br>
                        </div>
                    </div>
                    <!-- empty filler END -->

                    <!-- zero schedule START -->
                    <div id="rating_stud" class="p-4 content" style="display: flex;">
                        <div id="rat" style="display: flex;">
                            <div class="inner-wide" style="padding-left: 0 !important; margin-bottom: 40px;">
                                <i id="btn-stud-prev" class="bi bi-chevron-left"
                                   style="font-size: 32px; cursor: pointer;"></i>
                            </div>
                            <div id = "rat">
                                <!-- Выпадающий список для выбора предмета -->
                                <div>
                                    <select class="form-select" id="subject-rating">
                                        <!-- Опции выбора предмета -->
                                    </select>
                                    <!-- Контейнер для списка студентов и бара -->
                                    <div id="students-rating-list" class="my-4">
                                        <!-- Список студентов и их рейтинг -->
                                        <table id = "table-students"class="table">
                                            <thead>
                                                <tr>
                                                    <th>ФИО</th>
                                                    <th id = "n-group">Группа</th>
                                                    <th id = "n=prisyt">Пристустовал(мин)</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                
                                                
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <!-- Ссылка для сброса параметров поиска -->
                                <div style="text-align: center;">
                                  
                                    <a href="{% url 'student_rating' %}" class="text-decoration-none">
                                        {% trans "Reset search parameters" %}
                                    </a>
                                </div>
                            </div>
                            <div class="inner-wide" style="padding-right: 0 !important; margin-bottom: 40px;">
                                <i id="btn-stud-next" class="bi bi-chevron-right"
                                   style="font-size: 32px; cursor: pointer;"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- content END -->
            </div>
            <!-- primary screen END -->
        </div>
    </main>
    <!-- main END -->
{% endblock %}


{% block extra_js %}
    <script>
        const sidebar = document.getElementById("sidebar");
        const btn_sidebar_icon = document.getElementById("sidebar-icon");
        sidebar.addEventListener("shown.bs.collapse", () => {
            btn_sidebar_icon.className = "bi bi-x-lg bi-lg py-2 p-1";
        });
        sidebar.addEventListener("hidden.bs.collapse", () => {
            btn_sidebar_icon.className = "bi bi-list bi-lg py-2 p-1";
        });
    </script>
{% endblock %}
